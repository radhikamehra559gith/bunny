name: ğŸ¬ Video Processor

on:
  # âœ… Manual run from GitHub Actions tab
  workflow_dispatch:

  # âœ… Optional â€” uncomment if you want it to run on code pushes too
  # push:
  #   branches:
  #     - main

jobs:
  process_videos:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6h limit

    steps:
      # ğŸ§© Checkout your repo
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      # ğŸ§° Setup Python
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # âš™ï¸ Install dependencies
      - name: ğŸ“¦ Install system & Python dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          python -m pip install --upgrade pip
          pip install requests firebase-admin

      # ğŸ” Setup environment variables from GitHub Secrets
      - name: ğŸ”‘ Set environment variables
        env:
          BOT_ID: ${{ secrets.BOT_ID }}
          FIREBASE_CREDENTIALS_MAIN: ${{ secrets.FIREBASE_CREDENTIALS_MAIN }}
          FIREBASE_CREDENTIALS_VERIFY: ${{ secrets.FIREBASE_CREDENTIALS_VERIFY }}
          BUNNY_STORAGE_ZONE: ${{ secrets.BUNNY_STORAGE_ZONE }}
          BUNNY_API_KEY: ${{ secrets.BUNNY_API_KEY }}
          BUNNY_PULL_ZONE_URL: ${{ secrets.BUNNY_PULL_ZONE_URL }}
        run: |
          echo "âœ… Environment variables loaded"

      # ğŸš€ Run the main video automation script
      - name: ğŸï¸ Run Video Automation Script
        env:
          BOT_ID: ${{ secrets.BOT_ID }}
          FIREBASE_CREDENTIALS_MAIN: ${{ secrets.FIREBASE_CREDENTIALS_MAIN }}
          FIREBASE_CREDENTIALS_VERIFY: ${{ secrets.FIREBASE_CREDENTIALS_VERIFY }}
          BUNNY_STORAGE_ZONE: ${{ secrets.BUNNY_STORAGE_ZONE }}
          BUNNY_API_KEY: ${{ secrets.BUNNY_API_KEY }}
          BUNNY_PULL_ZONE_URL: ${{ secrets.BUNNY_PULL_ZONE_URL }}
        run: |
          python main.py

      # ğŸ§¹ Clean up workspace after run
      - name: ğŸ§½ Cleanup
        if: always()
        run: |
          rm -rf output_videos || true
          rm -f input.mp4 thumb.jpg || true
